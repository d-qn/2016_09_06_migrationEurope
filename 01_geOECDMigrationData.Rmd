---
title: "01_getEuropeanMigrationData"
author: "Duc-Quang Nguyen | swissinfo.ch"
date: " 2016"
output: 
  html_document:
    toc: true
    toc_depth: 3
    theme: simplex
---

## Data source

 * [Population on 1 January by five year age group, sex and citizenship](http://appsso.eurostat.ec.europa.eu/nui/show.do?dataset=migr_pop1ctz&lang=en)
 * [Immigration by five year age group, sex and country of birth](http://appsso.eurostat.ec.europa.eu/nui/show.do?dataset=migr_imm3ctb&lang=en) This dataset seems less complete

## Related

* [Metrocosm Which EU Country Has the Most Citizens Living Abroad?](http://metrocosm.com/eu-diaspora-map/)
* [Metrocosm The Ins and Outs of Immigration in the European Union](http://metrocosm.com/mapping-eu-immigration/)
* [Intra-european living elsewhere](http://www.economist.com/news/europe/21704813-eus-cherished-free-movement-rights-are-less-secure-they-seem-europes-scapegoat)

![chart](inspirations/20160813_EUC318.png)


```{r setup, include=FALSE}
downloadData <- T
runTest <- T

iso2.sub <- c('CH', 'DE', 'FR', 'IT', 'UK', 'PT', 'ES', 'SE', 'RO')

eu.migr.data.file <- "data/eurostat_migration.csv"
# Eurostat data tables
es.tb <- c('migr_pop1ctz')


library(readr)
library(tidyr)
library(dplyr)
library(magrittr)
library(countrycode)
library(ggplot2)
library(scales)
library(swiMap)
library(swiTheme)
library(forcats)

### Getting data in packages
library(OECD)
# ### Interactive 
# library(htmltools)
# library(shiny)
# library(swiRcharts)
# library(rCharts)

### Misc stuff
require(forcats)
```


### Get/load data

```{r load data, include = F}
### Get data from Eurostat
if(downloadData) {
  dat <- get_eurostat(es.tb, time_format = "raw", cache = F, keepFlags = T)
  
  # wrange & discard 
  data <- cbind(label_eurostat(dat %>% select(-flags)), iso2 = dat$geo)
  data$time <- as.numeric(data$time)
  # # add back data flags ??
  # data$flags <- dat$flags
  data %<>% 
    select (-unit) %>% filter(age == "Total", sex == "Total") %>%
    select (-age, -sex)
  write.csv(data, eu.migr.data.file, row.names = F)
} else {
  data <- read.csv(eu.migr.data.file)
}
```

## Compute the sum for EU-28 + EFTA
```{r wranglee}
eu.ct <- c(eu_countries[,1], efta_countries[,1])

eu <- data %>% filter(iso2 %in% eu.ct) %>% group_by(time, citizen) %>%
  summarise(tot = sum(values)) %>% ungroup()


```


